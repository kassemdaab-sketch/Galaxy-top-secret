<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="tab-title">Google Docs</title>
    <link id="favicon" rel="icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=JetBrains+Mono:wght@300;500&family=Outfit:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-main: #05010a; 
            --accent-hue: 280;
            --accent: hsl(var(--accent-hue), 100%, 53%); 
            --accent-glow: hsla(var(--accent-hue), 100%, 53%, 0.5);
            --glass: rgba(10, 2, 20, 0.85); 
            --border: hsla(var(--accent-hue), 100%, 53%, 0.3);
            --safe-green: #00ff99;
            --warning-orange: #ff9500;
        }

        body { 
            margin: 0; padding: 0; 
            font-family: 'Outfit', sans-serif; 
            background: var(--bg-main);
            color: #fff; overflow: hidden; height: 100vh;
            transition: opacity 0.5s ease, filter 0.5s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle 150px at var(--mouse-x, 50%) var(--mouse-y, 50%), hsla(var(--accent-hue), 100%, 50%, 0.15), transparent 80%);
            pointer-events: none;
            z-index: 5;
        }

        body.ghost-active {
            opacity: 0.4;
            filter: grayscale(0.8) contrast(1.2);
            pointer-events: all;
        }

        #bg-layer { 
            position: fixed; inset: 0; z-index: -1; 
            background-size: cover !important; 
            background-position: center !important; 
            background-repeat: no-repeat !important;
            transition: filter 0.3s ease; 
        }

        .engine-overload { filter: contrast(1.2) brightness(1.1); }
        .engine-overload h1, .engine-overload .nav-btn {
            text-shadow: 2px 0 #ff00ff, -2px 0 #00ffff !important;
            animation: glitch 0.2s infinite alternate;
        }

        .card:hover {
            box-shadow: 0 0 20px var(--accent-glow);
            border-color: var(--accent);
            transform: translateY(-2px);
            transition: 0.3s;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            100% { transform: translate(1px, -1px); }
        }

        #scanlines {
            position: fixed; inset: 0; 
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%);
            background-size: 100% 3px; z-index: 5000; pointer-events: none; opacity: 0; transition: 0.3s;
        }
        .scanlines-on #scanlines { opacity: 1; }

        @keyframes rainbowFull {
            0% { border-color: #ff0000; color: #ff0000; box-shadow: 0 0 15px #ff0000; }
            33% { border-color: #00ff00; color: #00ff00; box-shadow: 0 0 15px #00ff00; }
            66% { border-color: #00ffff; color: #00ffff; box-shadow: 0 0 15px #00ffff; }
            100% { border-color: #ff0000; color: #ff0000; box-shadow: 0 0 15px #ff0000; }
        }
        .rainbow-active .nav-btn, .rainbow-active .card, .rainbow-active h1, 
        .rainbow-active #search-box, .rainbow-active .header-pill { 
            animation: rainbowFull 4s infinite linear !important; 
        }

        #neural-header { position: fixed; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; z-index: 1000; }
        .header-pill { background: var(--glass); padding: 8px 18px; border-radius: 6px; border: 1px solid var(--border); backdrop-filter: blur(15px); font-family: 'JetBrains Mono'; color: var(--accent); font-size: 0.75rem; display: flex; align-items: center; gap: 8px; cursor: default; }
        
        #system-logs {
            position: fixed; bottom: 20px; left: 20px; width: 260px; height: 130px;
            background: rgba(0,0,0,0.8); border: 1px solid var(--border); border-radius: 4px;
            font-family: 'JetBrains Mono'; font-size: 0.6rem; color: var(--safe-green);
            padding: 10px; overflow: hidden; pointer-events: none; z-index: 500;
        }

        #widget-drawer { 
            position: fixed; right: -320px; top: 80px; bottom: 80px; width: 300px; 
            background: var(--glass); backdrop-filter: blur(40px); border: 1px solid var(--border); 
            border-radius: 20px 0 0 20px; transition: 0.6s cubic-bezier(0.19, 1, 0.22, 1); 
            z-index: 9999; padding: 25px; box-sizing: border-box; 
        }
        #widget-drawer.open { right: 0; }
        #drawer-tab { 
            position: absolute; left: -40px; top: 50%; transform: translateY(-50%); 
            background: var(--accent); color: white; width: 40px; height: 120px; 
            border-radius: 8px 0 0 8px; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; font-family: 'Orbitron'; font-size: 0.6rem; writing-mode: vertical-rl; 
            z-index: 10000; box-shadow: -5px 0 15px var(--accent-glow);
        }

        #main-content { display: none; text-align: center; padding-top: 60px; height: 100vh; overflow-y: auto; position: relative; z-index: 10; transition: transform 0.2s ease-out; }
        h1 { font-family: 'Orbitron'; font-size: 4.5rem; font-weight: 900; margin: 20px 0; letter-spacing: 12px; transition: 0.3s; }
        h1:hover { letter-spacing: 20px; color: var(--accent); text-shadow: 0 0 30px var(--accent); }

        #search-box { width: 450px; padding: 15px 25px; background: rgba(0,0,0,0.4); border: 1px solid var(--border); border-radius: 4px; color: white; font-family: 'JetBrains Mono'; outline: none; transition: 0.3s; }
        #search-box:focus { width: 500px; border-color: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }

        .nav-btn { display: inline-block; margin: 10px; padding: 12px 30px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); color: white; text-decoration: none; font-family: 'Orbitron'; font-size: 0.75rem; letter-spacing: 2px; transition: 0.3s; position: relative; overflow: hidden; }
        .nav-btn::after { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255,255,255,0.1); border-radius: 50%; transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
        .nav-btn:hover::after { width: 300px; height: 300px; }
        .nav-btn:hover { background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); transform: scale(1.05); }

        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1200px; margin: 40px auto; padding: 0 20px 100px 20px; }
        .card { background: var(--glass); padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: left; position: relative; }
        
        .action-btn { width: 100%; padding: 10px; margin-top: 8px; background: rgba(255,255,255,0.05); color: #ccc; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; cursor: pointer; font-family: 'JetBrains Mono'; font-size: 0.65rem; transition: 0.2s; text-align: center; }
        .action-btn:hover { background: var(--accent); color: white; transform: translateX(5px); }

        .btn-row { display: flex; gap: 5px; }

        #stealth-overlay { position: fixed; inset: 0; background: #f0f2f5; color: #1c1e21; z-index: 100000; display: none; padding: 40px; font-family: sans-serif; text-align: left; }
        #stars-canvas { position: fixed; inset: 0; z-index: -2; background: #05010a; }
        .star { position: absolute; background: #fff; border-radius: 50%; pointer-events: none; }
        .particle { position: fixed; pointer-events: none; z-index: 9998; border-radius: 50%; transition: transform 0.8s ease-out, opacity 0.8s ease-out; }

        #speed-hud { font-size: 0.6rem; min-width: 120px; }
        #speed-bar { width: 50px; height: 4px; background: #222; border-radius: 2px; overflow: hidden; display: inline-block; vertical-align: middle; margin-left: 5px; }
        #speed-fill { height: 100%; width: 0%; background: var(--accent); transition: width 0.1s ease; }

        #matrix-canvas {
            position: fixed;
            inset: 0;
            z-index: -2;
            background: #05010a;
            display: none;
        }
    </style>
</head>
<body onmousemove="handleMouseMove(event)">
    <div id="bg-layer"></div>
    <div id="scanlines"></div>
    <div id="system-logs"></div>
    <div id="stealth-overlay" onclick="toggleStealth()">
        <div style="max-width: 800px; margin: auto;">
            <h2 style="color: #1877f2;">Google Workspace</h2>
            <p>Searching My Drive...</p>
            <hr>
            <div style="height: 150px; background: #eee; border-radius: 8px;"></div>
        </div>
    </div>
    
    <div id="admin-overlay" style="position:fixed; inset:0; background:rgba(5,1,10,0.95); display:none; justify-content:center; align-items:center; z-index:12000; backdrop-filter: blur(15px);">
        <div class="card" style="width:450px; text-align:left; border: 1px solid var(--warning-orange); padding: 30px; box-shadow: 0 0 20px rgba(255, 149, 0, 0.4);">
            <h2 style="font-family:'Orbitron'; text-align:center; color:var(--warning-orange); margin-bottom: 20px;">ADMIN PANEL</h2>
            <p style="font-family:'JetBrains Mono'; font-size:0.7rem; color:#ccc; text-align:center;">MANAGE REGISTERED ACCOUNTS</p>
            <div id="admin-user-list" style="max-height: 250px; overflow-y: auto; background: rgba(0,0,0,0.6); border: 1px solid #333; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
                </div>
            <button onclick="document.getElementById('admin-overlay').style.display='none'" class="action-btn" style="background:var(--warning-orange); color:black; font-weight:bold; font-family:'Orbitron';">CLOSE PANEL</button>
        </div>
    </div>
    <div id="neural-header">
        <div style="display: flex; gap: 10px;">
            <div class="header-pill" id="neural-clock">00:00:00</div>
            <div class="header-pill" id="weather-display" style="color:var(--safe-green)">ATMOS: SYNCING...</div>
            <div class="header-pill" id="speed-hud">VEL: <span id="speed-val">0</span> <div id="speed-bar"><div id="speed-fill"></div></div></div>
        </div>
        <div style="display: flex; gap: 10px;">
            <div class="header-pill" id="timer-display" style="display:none; color:var(--warning-orange)">T-MINUS: 00:00</div>
            <div class="header-pill" id="pilot-id">PILOT: UNKNOWN</div>
        </div>
    </div>

    <div id="widget-drawer">
        <div id="drawer-tab" onclick="toggleDrawer()">ENGINE CONTROL</div>
        <div class="engine-select-container" style="margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent); display: block; margin-bottom: 5px;">TAB CLOAK SECTOR:</label>
            <select id="cloak-selector" onchange="applyCloak(this.value); saveSettings();" style="width: 100%; background: black; color: #fff; border: 1px solid var(--border); font-family: 'Orbitron'; font-size: 0.7rem; padding: 8px; margin-bottom: 10px;">
                <optgroup label="Workspace">
                    <option value="docs">Google Docs</option>
                    <option value="drive">Google Drive</option>
                    <option value="classroom">Google Classroom</option>
                    <option value="sheets">Google Sheets</option>
                    <option value="slides">Google Slides</option>
                    <option value="gmail">Gmail</option>
                </optgroup>
                <optgroup label="Education">
                    <option value="canvas">Canvas</option>
                    <option value="teams">Microsoft Teams</option>
                    <option value="zoom">Zoom</option>
                </optgroup>
                <optgroup label="Other">
                    <option value="wikipedia">Wikipedia</option>
                    <option value="youtube">YouTube</option>
                    <option value="outlook">Outlook</option>
                    <option value="none">Galaxy Pro (Default)</option>
                </optgroup>
            </select>
            <label style="font-size: 0.6rem; color: var(--accent); display: block; margin-bottom: 5px;">DATABASE UPLINK:</label>
            <select id="engine-selector" onchange="setEngine(this.value); saveSettings();" style="width: 100%; background: black; color: var(--accent); border: 1px solid var(--border); font-family: 'Orbitron'; font-size: 0.7rem; padding: 8px;">
                <option value="google">GOOGLE</option>
                <option value="duckduckgo">DUCKDUCKGO</option>
                <option value="bing">BING</option>
                <option value="yahoo">YAHOO</option>
            </select>
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent);">Customize Color:</label>
            <input type="range" id="hue-slider" min="0" max="360" value="280" oninput="updateHue(this.value); saveSettings();">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent);">Star Density: <span id="density-val">70</span></label>
            <input type="range" id="density-slider" min="10" max="200" value="70" oninput="updateDensity(this.value); saveSettings();">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent);">Stars Movement: <span id="velocity-val">1.0</span>x</label>
            <input type="range" id="velocity-slider" min="0.1" max="5.0" step="0.1" value="1.0" oninput="updateVelocity(this.value); saveSettings();">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent);">Background Blur:</label>
            <input type="range" id="blur-slider" min="0" max="25" value="0" oninput="applyBlur(this.value); saveSettings();">
        </div>
        
        <div class="btn-row">
            <button class="action-btn" onclick="toggleRainbow(); saveSettings();">TOGGLE RGB SYNC</button>
            <button class="action-btn" onclick="toggleGhostMode(); saveSettings();" style="border-color: rgba(255,255,255,0.3);">TOGGLE GHOST ENGINE</button>
        </div>
        
        <button class="action-btn" onclick="toggleScanlines(); saveSettings();">TOGGLE SCANLINES</button>
        <button class="action-btn" onclick="toggleEngine(); saveSettings();">TOGGLE GLITCH ENGINE</button>
        
        <div style="margin-top: 15px;">
            <label style="font-size: 0.6rem; color: var(--accent);">Press ` to redirect:</label>
            <input type="text" id="panic-url" oninput="saveSettings()" style="width:100%; background:black; color:white; border:1px solid var(--border); font-size:0.6rem; padding:5px; margin-top:5px;">
        </div>
        <textarea id="note-pad" placeholder="Personal Notes" oninput="saveSettings()" style="width:100%; height:120px; background:black; border:1px solid var(--border); color:var(--safe-green); font-family:'JetBrains Mono'; font-size:0.7rem; margin-top:10px; outline:none;"></textarea>
    </div>

    <div id="auth-overlay" style="position:fixed; inset:0; background:#05010a; display:flex; justify-content:center; align-items:center; z-index:10000;">
        <div class="card" style="width:320px; text-align:center;">
            <h2 style="font-family:'Orbitron';">Sign in</h2>
            <input type="text" id="user-in" placeholder="Username" style="width:80%; padding:12px; margin:20px 0; background:rgba(0,0,0,0.5); color:white; border:1px solid var(--border); text-align:center; font-family:'Orbitron'; outline:none;">
            <button onclick="login()" class="action-btn" style="background:var(--accent); color:white;">ENTER</button>
        </div>
    </div>

    <div id="instructions-overlay" style="position:fixed; inset:0; background:rgba(5,1,10,0.98); display:none; justify-content:center; align-items:center; z-index:11000; backdrop-filter: blur(15px);">
        <div class="card" style="width:500px; text-align:left; border: 1px solid var(--accent); padding: 30px; max-height: 90vh; overflow-y: auto;">
            <h2 style="font-family:'Orbitron'; text-align:center; color:var(--accent); margin-bottom: 20px;">COMMAND PROTOCOLS</h2>
            <div style="font-family:'JetBrains Mono'; font-size:0.7rem; line-height:1.6; color:#eee;">
                <p><b style="color:var(--safe-green);">[ALT + P]</b> : PROXIES</p>
                <p><b style="color:var(--safe-green);">[CTRL + M]</b> : MOVIES</p>
                <p><b style="color:var(--safe-green);">[CTRL + G]</b> : GALAXY GAMES</p>
                <p><b style="color:var(--accent);">[CTRL + S]</b> : TOGGLE SCANLINES</p>
                <p><b style="color:var(--accent);">[CTRL + R]</b> : TOGGLE RGB SYNC</p>
                <p><b style="color:var(--accent);">[CTRL + E]</b> : TOGGLE GLITCH ENGINE</p>
                <p><b style="color:var(--warning-orange);">[ ` ] (Backtick)</b> : PANIC REDIRECT</p>
                <p><b style="color:#ff4444;">[CTRL + B]</b> : SYSTEM BURN (Full Reset)</p>
                <p><b style="color:var(--accent);">[ESC]</b> : STEALTH OVERLAY</p>
            </div>
            <button onclick="closeInstructions()" class="action-btn" style="background:var(--accent); color:white; margin-top:25px; font-family:'Orbitron'; letter-spacing:2px;">I UNDERSTAND</button>
        </div>
    </div>

    <div id="main-content">
        <form id="search-form" action="https://www.google.com/search" method="GET" target="_blank">
            <input type="text" name="q" id="search-box" placeholder="Search something...">
        </form>
        <h1 id="glitch-title">Galaxy Pro</h1>
        <div>
            <a href="https://sites.google.com/fcpsschools.net/galaxy-ulimate-gaming/games" target="_blank" id="btn-games" class="nav-btn">Games</a>
            <a href="https://sflix.ps/" target="_blank" id="btn-movies" class="nav-btn">Movies</a>
            <a href="https://sites.google.com/fcpsschools.net/math-7-honors-courses/math-7-honors-courses" target="_blank" id="btn-proxies" class="nav-btn">Proxies</a>
        </div>
        <div class="settings-grid">
            <div class="card">
                <label style="color:var(--accent); font-size:0.6rem; font-family:'Orbitron';">Timer</label>
                <input type="number" id="timer-input" placeholder="MINS" style="width:90%; background:black; color:white; border:1px solid var(--border); margin: 8px 0; padding: 5px; font-family:'JetBrains Mono';">
                <button class="action-btn" onclick="startTimer()" style="background: var(--warning-orange); color:black; font-weight:bold;">START COUNTDOWN</button>
                <button class="action-btn" onclick="stopTimer()">Stop timer</button>
            </div>
            <div class="card">
                <label style="color:var(--accent); font-size:0.6rem; font-family:'Orbitron';">Select Mouse Trails</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                    <button class="action-btn" onclick="setTail('rainbow'); saveSettings();">PLASMA</button>
                    <button class="action-btn" onclick="setTail('neon'); saveSettings();">TRACE</button>
                    <button class="action-btn" onclick="setTail('spark'); saveSettings();">SPARK</button>
                    <button class="action-btn" onclick="setTail('shock'); saveSettings();">SHOCK</button>
                    <button class="action-btn" onclick="setTail('ghost'); saveSettings();">GHOST</button>
                    <button class="action-btn" onclick="setTail('void'); saveSettings();">VOID</button>
                </div>
                <div style="margin-top:15px;">
                    <label style="color:var(--accent); font-size:0.6rem; font-family:'Orbitron';">PARTICLE DENSITY: <span id="tail-density-val">1</span></label>
                    <input type="range" id="tail-density-slider" min="1" max="10" value="1" oninput="updateTailDensity(this.value); saveSettings();">
                </div>
            </div>
            <div class="card">
                <label style="color:var(--accent); font-size:0.6rem; font-family:'Orbitron';">SYSTEM CONFIG</label>
                <button class="action-btn" onclick="document.getElementById('instructions-overlay').style.display='flex'">VIEW PROTOCOLS</button>
                <button class="action-btn" onclick="toggleCloak()" id="cloak-btn">ENABLE STEALTH TAB</button>
                <button class="action-btn" onclick="clearLogs()" style="border-color: rgba(255,0,0,0.2);">WIPE LOGS</button>
                <button id="admin-launch-btn" class="action-btn" onclick="openAdminPanel()" style="display:none; background:var(--warning-orange); color:black; font-weight:bold;">OPEN ADMIN PANEL</button>
            </div>
            <div class="card">
                <label style="color:var(--accent); font-size:0.6rem; font-family:'Orbitron';">Select Background</label>
                <label for="bg-up" class="action-btn" style="display:block; background:var(--safe-green); color:black; cursor:pointer;">UPLOAD BACKGROUND</label>
                <input type="file" id="bg-up" accept="image/*" style="display:none" onchange="applyBG(this)">
                <button class="action-btn" onclick="resetBG()">Remove background</button>
                <button class="action-btn" onclick="logout()" style="color:#ff4444; margin-top:10px;">LOGOUT</button>
            </div>
        </div>
    </div>
    <div id="stars-canvas"></div>
    <canvas id="matrix-canvas"></canvas>

    <script>
        let currentTail = 'rainbow', hue = 0, timerInterval, isCloaked = false;
        let starDensity = 70, starVelocity = 1.0, tailParticleDensity = 1;
        let starObjects = [];
        let matrixActive = false;

        const cloaks = {
            docs: { title: "Google Docs", icon: "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" },
            drive: { title: "My Drive - Google Drive", icon: "https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png" },
            classroom: { title: "Classes", icon: "https://ssl.gstatic.com/classroom/favicon.png" },
            sheets: { title: "Google Sheets", icon: "https://ssl.gstatic.com/docs/spreadsheets/favicon3.ico" },
            slides: { title: "Google Slides", icon: "https://ssl.gstatic.com/docs/presentations/images/favicon5.ico" },
            gmail: { title: "Gmail", icon: "https://ssl.gstatic.com/ui/v1/icons/mail/images/favicon5.ico" },
            canvas: { title: "Dashboard", icon: "https://du11bjcvkw674.cloudfront.net/favicon.ico" },
            teams: { title: "Microsoft Teams", icon: "https://statics.teams.cdn.office.net/evergreen-assets/apps/teams_app_icon_v2.ico" },
            zoom: { title: "Zoom", icon: "https://st1.zoom.us/zoom.ico" },
            wikipedia: { title: "Wikipedia", icon: "https://en.wikipedia.org/static/favicon/wikipedia.ico" },
            youtube: { title: "YouTube", icon: "https://www.youtube.com/s/desktop/28e029f1/img/favicon_32x32.png" },
            outlook: { title: "Outlook", icon: "https://res.cdn.office.net/owamail/20231020005.01/resources/images/favicon.ico" },
            none: { title: "GALAXY PRO", icon: "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico" }
        };

        window.addEventListener('keydown', (e) => {
            if (e.altKey && e.key.toLowerCase() === 'p') {
                e.preventDefault();
                window.open(document.getElementById('btn-proxies').href, '_blank');
            }
            if (e.ctrlKey && e.key.toLowerCase() === 'm') {
                e.preventDefault();
                window.open(document.getElementById('btn-movies').href, '_blank');
            }
            if (e.ctrlKey && e.key.toLowerCase() === 'g') {
                e.preventDefault();
                window.open(document.getElementById('btn-games').href, '_blank');
            }
            if (e.ctrlKey && e.key.toLowerCase() === 's') {
                e.preventDefault();
                toggleScanlines();
                saveSettings();
            }
            if (e.ctrlKey && e.key.toLowerCase() === 'r') {
                e.preventDefault();
                toggleRainbow();
                saveSettings();
            }
            if (e.ctrlKey && e.key.toLowerCase() === 'e') {
                e.preventDefault();
                toggleEngine();
                saveSettings();
            }
            if (e.key === '`') {
                e.preventDefault();
                const panic = document.getElementById('panic-url').value || "https://lms.fcps.edu/home";
                window.location.href = panic;
            }
            if (e.ctrlKey && e.key.toLowerCase() === 'b') {
                e.preventDefault();
                if(confirm("INITIATE FULL SYSTEM WIPE?")) {
                    localStorage.clear();
                    location.reload();
                }
            }
            if (e.key === 'Escape') {
                e.preventDefault();
                toggleStealth();
            }
        });

        function applyCloak(type) {
            const data = cloaks[type] || cloaks.none;
            document.getElementById('favicon').href = data.icon;
            document.title = data.title;
            logMessage("STEALTH: CLOAK_SET_" + type.toUpperCase());
        }

        function setEngine(engine) {
            const form = document.getElementById('search-form');
            const box = document.getElementById('search-box');
            switch(engine) {
                case 'google': form.action = "https://www.google.com/search"; box.placeholder = "UPLINK: GOOGLE DATABASE..."; break;
                case 'duckduckgo': form.action = "https://duckduckgo.com/"; box.placeholder = "UPLINK: DUCKDUCKGO DATABASE..."; break;
                case 'bing': form.action = "https://www.bing.com/search"; box.placeholder = "UPLINK: BING DATABASE..."; break;
                case 'yahoo': form.action = "https://search.yahoo.com/search"; box.placeholder = "UPLINK: YAHOO DATABASE..."; break;
            }
        }

        let lastX = 0, lastY = 0;
        function handleMouseMove(e) {
            document.body.style.setProperty('--mouse-x', e.clientX + 'px');
            document.body.style.setProperty('--mouse-y', e.clientY + 'px');

            for (let i = 0; i < tailParticleDensity; i++) { createTail(e); }
            const dx = e.clientX - lastX; const dy = e.clientY - lastY;
            const speed = Math.round(Math.sqrt(dx*dx + dy*dy));
            lastX = e.clientX; lastY = e.clientY;
            const hudVal = document.getElementById('speed-val'); const hudFill = document.getElementById('speed-fill');
            if(hudVal) hudVal.innerText = speed; if(hudFill) hudFill.style.width = Math.min(speed, 100) + "%";
        }

        function updateHue(val) { document.documentElement.style.setProperty('--accent-hue', val); }
        function updateTailDensity(val) { tailParticleDensity = parseInt(val); document.getElementById('tail-density-val').innerText = val; }
        function updateDensity(val) { starDensity = val; document.getElementById('density-val').innerText = val; setStars(); }
        function updateVelocity(val) { starVelocity = val; document.getElementById('velocity-val').innerText = val; }
        function toggleEngine() { document.body.classList.toggle('engine-overload'); logMessage("ENGINE: GLITCH_MODE"); }
        function toggleRainbow() { document.body.classList.toggle('rainbow-active'); logMessage("ENGINE: RGB_SYNC"); }
        function toggleScanlines() { document.body.classList.toggle('scanlines-on'); logMessage("ENGINE: SCANLINES"); }
        function toggleGhostMode() { 
            document.body.classList.toggle('ghost-active'); 
            const isActive = document.body.classList.contains('ghost-active');
            logMessage("ENGINE: GHOST_MODE_" + (isActive ? "ON" : "OFF"));
        }
        function applyBlur(val) { document.getElementById('bg-layer').style.filter = `blur(${val}px)`; }
        function toggleDrawer() { document.getElementById('widget-drawer').classList.toggle('open'); }
        function toggleStealth() { const s = document.getElementById('stealth-overlay'); s.style.display = (s.style.display === 'block') ? 'none' : 'block'; }
        function toggleCloak() {
            isCloaked = !isCloaked; const btn = document.getElementById('cloak-btn');
            const selector = document.getElementById('cloak-selector');
            if (isCloaked) { applyCloak(selector.value); btn.innerText = "RESTORE TAB"; } 
            else { applyCloak('none'); btn.innerText = "ENABLE STEALTH TAB"; }
        }

        function startTimer() {
            clearInterval(timerInterval); let mins = document.getElementById('timer-input').value; if (!mins || mins <= 0) return;
            let target = new Date().getTime() + mins * 60000; document.getElementById('timer-display').style.display = 'flex';
            timerInterval = setInterval(() => {
                let diff = target - new Date().getTime(); if (diff <= 0) { clearInterval(timerInterval); alert("Timer ended"); return; }
                let m = Math.floor(diff / 60000), s = Math.floor((diff % 60000) / 1000);
                document.getElementById('timer-display').innerText = `T-MINUS: ${m}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInterval); document.getElementById('timer-display').style.display = 'none'; }
        
        function applyBG(input) { 
            if (input.files && input.files[0]) { 
                const reader = new FileReader(); 
                reader.onload = (e) => { 
                    const imgData = e.target.result; 
                    const bgLayer = document.getElementById('bg-layer');
                    bgLayer.style.backgroundImage = `url('${imgData}')`; 
                    localStorage.setItem('galaxy_bg_stable', imgData); 
                    logMessage("CORE: BACKGROUND_UPDATED");
                }; 
                reader.readAsDataURL(input.files[0]); 
            } 
        }
        function resetBG() { 
            document.getElementById('bg-layer').style.backgroundImage = 'none'; 
            localStorage.removeItem('galaxy_bg_stable'); 
            logMessage("CORE: VISUALS_RESET");
        }

        function saveSettings() {
            const settings = {
                rainbow: document.body.classList.contains('rainbow-active'), scanlines: document.body.classList.contains('scanlines-on'),
                glitch: document.body.classList.contains('engine-overload'), ghost: document.body.classList.contains('ghost-active'),
                blur: document.getElementById('blur-slider').value,
                tail: currentTail, panicUrl: document.getElementById('panic-url').value, notes: document.getElementById('note-pad').value,
                density: starDensity, velocity: starVelocity, hue: document.getElementById('hue-slider').value,
                engine: document.getElementById('engine-selector').value, cloakType: document.getElementById('cloak-selector').value,
                tailDensity: tailParticleDensity, matrix: matrixActive
            };
            localStorage.setItem('galaxy_settings_pro', JSON.stringify(settings));
        }

        function logMessage(msg) {
            const logs = document.getElementById('system-logs');
            const entry = document.createElement('div');
            entry.innerText = `> ${new Date().toLocaleTimeString()}: ${msg}`;
            logs.prepend(entry);
        }

        setInterval(() => {
            document.getElementById('neural-clock').innerText = new Date().toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>

    const usernameInput = document.getElementById('user-in').value.trim();
    const username = usernameInput || "PILOT";
    
    // 2. Check if user is banned
    let bannedUsers = JSON.parse(localStorage.getItem('galaxy_banned_users') || '[]');
    if (bannedUsers.includes(username.toLowerCase())) {
        alert("ERROR 403: ACCOUNT HAS BEEN BANNED BY ADMIN");
        return;
    }

    // 3. Register user if not Kassem
    if (username.toLowerCase() !== 'kassem') {
        let registered = JSON.parse(localStorage.getItem('galaxy_registered_users') || '[]');
        if (!registered.includes(username)) {
            registered.push(username);
            Item('galaxy_registered_users', JSON.stringify(registered));localStorage.set
        }
    }

    localStorage.setItem('galaxy_user', username);
    loadSession();
}
        function loadSession() {
            const user = localStorage.getItem('galaxy_user');
            if (user) {
                document.getElementById('auth-overlay').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                document.getElementById('pilot-id').innerText = `PILOT: ${user.toUpperCase()}`;
                logMessage("SYSTEM: AUTH_SUCCESS");

                // Reveal Admin button if user is Kassem
                if (user.toLowerCase() === 'kassem') {
                    document.getElementById('admin-launch-btn').style.display = 'block';
                    logMessage("SYSTEM: ADMIN_ACCESS_GRANTED");
                }
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-overlay').style.display = 'flex';
            renderUserList();
        }

        function renderUserList() {
            const listDiv = document.getElementById('admin-user-list');
            let registered = JSON.parse(localStorage.getItem('galaxy_registered_users') || '[]');
            listDiv.innerHTML = '';

            if (registered.length === 0) {
                listDiv.innerHTML = '<p style="color:#aaa; font-family:JetBrains Mono; font-size:0.8rem; text-align:center;">No users registered yet.</p>';
                return;
            }

            registered.forEach(user => {
                const div = document.createElement('div');
                div.style.cssText = 'display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #333; font-family:JetBrains Mono; font-size:0.8rem;';
                div.innerHTML = `
                    <span style="color:var(--safe-green);">${user}</span>
                    <button onclick="banUser('${user}')" style="background:#ff4444; color:white; border:none; border-radius:3px; padding:5px 12px; cursor:pointer; font-family:Orbitron; font-size:0.6rem; font-weight:bold;">BAN</button>
                `;
                listDiv.appendChild(div);
            });
        }

        function banUser(username) {
    if(confirm(`WARNING: This will PERMANENTLY ban this DEVICE and the user ${username}. Proceed?`)) {
        
        // 1. Mark the DEVICE as blocked
        localStorage.setItem('galaxy_device_blocked', 'true');

        // 2. Add username to ban list (existing logic)
        let banned = JSON.parse(localStorage.getItem('galaxy_banned_users') || '[]');
        if (!banned.includes(username.toLowerCase())) {
            banned.push(username.toLowerCase());
            localStorage.setItem('galaxy_banned_users', JSON.stringify(banned));
        }

        // 3. Remove from registered list (existing logic)
        let registered = JSON.parse(localStorage.getItem('galaxy_registered_users') || '[]');
        registered = registered.filter(u => u !== username);
        localStorage.setItem('galaxy_registered_users', JSON.stringify(registered));

        logMessage(`ADMIN: DEVICE_BANNED_VIA_${username.toUpperCase()}`);
        
        // 4. Force immediate lockdown
        location.reload(); 
    }
}
        /* ------------------------------------------- */

        function logout() { localStorage.removeItem('galaxy_user'); location.reload(); }
        function closeInstructions() { document.getElementById('instructions-overlay').style.display = 'none'; }

        function logMessage(msg) { 
            const lb = document.getElementById('system-logs'); 
            if(!lb) return; 
            const div = document.createElement('div'); 
            div.innerText = `> [${new Date().toLocaleTimeString()}] ${msg}`; 
            lb.prepend(div); 
            if(lb.childNodes.length > 6) lb.lastChild.remove(); 
        }
        
        function clearLogs() { document.getElementById('system-logs').innerHTML = ''; }

        function setTail(type) {
            currentTail = type;
        }

        /* Completing the missing code from the cutoff */
        function createTail(e) {
            const t = document.createElement('div');
            t.className = 'particle';
            t.style.left = e.clientX + 'px';
            t.style.top = e.clientY + 'px';
            t.style.width = '6px';
            t.style.height = '6px';
            t.style.background = currentTail === 'rainbow' ? `hsl(${Math.random()*360}, 100%, 50%)` : 'var(--accent)';
            document.body.appendChild(t);
            setTimeout(() => {
                t.style.opacity = '0';
                t.style.transform = `translateY(${Math.random() * 40 - 20}px) translateX(${Math.random() * 40 - 20}px)`;
                setTimeout(() => t.remove(), 800);
            }, 10);
        }

        function setStars() {
            const container = document.getElementById('stars-canvas');
            container.innerHTML = ''; starObjects = [];
            for(let i=0; i<starDensity; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                const size = Math.random()*2+1;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                s.style.width = size + 'px';
                s.style.height = size + 'px';
                s.style.left = x + '%';
                s.style.top = y + '%';
                s.style.opacity = Math.random();
                
                container.appendChild(s);
                starObjects.push({ el: s, x: x, y: y, speed: (Math.random() * 0.05 + 0.02) });
            }
        }

        function animateStars() {
            starObjects.forEach(star => {
                star.y -= star.speed * starVelocity;
                if (star.y < 0) { 
                    star.y = 100; 
                    star.x = Math.random() * 100; 
                }
                star.el.style.top = star.y + '%';
                star.el.style.left = star.x + '%';
            });
            requestAnimationFrame(animateStars);
        }

        // Initialize Everything
        window.onload = () => {
            setStars();
            animateStars();
            loadSession();
            
            // Run Clock
            setInterval(() => {
                document.getElementById('neural-clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: false });
            }, 1000);
        };
        function createTail(e) {
    // 1. Create the particle element
    const p = document.createElement('div');
    p.className = 'particle';
    
    // Default size and position (will be overridden by specific cases like 'ghost')
    const size = Math.random() * 5 + 5;
    p.style.width = size + 'px';
    p.style.height = size + 'px';
    p.style.left = e.clientX + 'px';
    p.style.top = e.clientY + 'px';
    p.style.position = 'fixed';
    p.style.pointerEvents = 'none';
    p.style.zIndex = '9998';
    p.style.borderRadius = '50%'; // Default round, 'neon' will override to square

    // 2. Apply your custom "Neural Tails" styles
    switch(currentTail) {
        case 'neon': 
            p.style.background = 'transparent';
            p.style.border = '3.5px solid var(--accent)';
            p.style.boxShadow = '0 0 30px var(--accent-glow)';
            p.style.borderRadius = '0px'; 
            break;
        case 'rainbow':
            p.style.background = `hsl(${hue}, 100%, 50%)`;
            p.style.boxShadow = `0 0 8px hsl(${hue}, 100%, 50%)`;
            hue = (hue + 5) % 360;
            break;
        case 'spark':
            p.style.background = '#fff';
            p.style.boxShadow = '0 0 10px #fff, 0 0 20px var(--accent)';
            break;
        case 'shock':
            p.style.background = '#00ffff';
            p.style.width = '1px';
            p.style.height = '15px';
            p.style.transform = `rotate(${Math.random() * 360}deg)`;
            break;
        case 'ghost':
            const ghostSize = Math.random() * 50 + 40; 
            p.style.width = ghostSize + 'px';
            p.style.height = ghostSize + 'px';
            p.style.left = (e.clientX - ghostSize/2) + 'px';
            p.style.top = (e.clientY - ghostSize/2) + 'px';
            p.style.background = 'radial-gradient(circle, rgba(255,255,255,0.6) 0%, rgba(200,150,255,0.2) 30%, transparent 70%)';
            p.style.filter = 'blur(6px)';
            p.style.backdropFilter = 'blur(10px) brightness(1.6) contrast(1.2)';
            p.style.webkitBackdropFilter = 'blur(10px) brightness(1.6) contrast(1.2)';
            p.style.borderRadius = '50%';
            p.style.boxShadow = '0 0 15px rgba(255,255,255,0.3)';
            break;
        case 'void':
            const voidSize = Math.random() * 10 + 15;
            p.style.width = voidSize + 'px';
            p.style.height = voidSize + 'px';
            p.style.background = '#000';
            p.style.boxShadow = '0 0 10px #000, 0 0 5px var(--accent)';
            p.style.left = (e.clientX - voidSize/2) + 'px';
            p.style.top = (e.clientY - voidSize/2) + 'px';
            break;
    }

    document.body.appendChild(p);

    // 3. Animation and Cleanup
    // This moves the particle slightly and fades it out
    const animX = (Math.random() - 0.5) * 50;
    const animY = (Math.random() - 0.5) * 50;

    setTimeout(() => {
        p.style.transition = 'all 0.8s ease-out';
        p.style.transform += ` translate(${animX}px, ${animY}px) scale(0)`;
        p.style.opacity = '0';
        setTimeout(() => p.remove(), 800);
    }, 10);
}

// Ensure the setter function exists so your buttons work
function setTail(type) {
    currentTail = type;
    logMessage("SYSTEM: TRAIL_CORE_SWITCHED_" + type.toUpperCase());
}
    </script>
</body>
</html>
